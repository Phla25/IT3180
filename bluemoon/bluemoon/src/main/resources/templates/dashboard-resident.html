<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - C∆∞ D√¢n - BlueMoon Portal</title>
    
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ==================== FEATURE TOGGLE STYLES ==================== */
        .feature-badge {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 8px;
            margin-left: auto;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        /* ... c√°c style kh√°c ... */
    </style>
</head>

<body>
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-building"></i>
                <span>BlueMoon Portal</span>
            </div>
            <div class="user-profile">
                <div class="avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-info">
                    <span class="user-name" th:text="${user?.hoVaTen} ?: 'T√™n Ng∆∞·ªùi D√πng'">T√™n Ng∆∞·ªùi D√πng</span>
                    <span class="user-role" th:text="${user?.vaiTro?.dbValue} ?: 'C∆∞ D√¢n'">Vai Tr√≤</span>
                </div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <a th:href="@{/resident/dashboard}" class="nav-item active">
                <i class="fas fa-chart-line"></i>
                <span>Dashboard</span>
            </a>
            </nav>
        </aside>

    <header class="header">
        <div class="header-left">
            <button class="menu-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <h1>Dashboard C∆∞ D√¢n</h1>
        </div>
        
        <div class="header-right">
            <div class="user-menu">
                <div class="user-info">
                    <span class="user-name" th:text="${user?.hoVaTen} ?: 'N/A'">Nguy·ªÖn VƒÉn Thanh</span>
                    <span class="user-role" th:text="${user?.vaiTro?.dbValue} ?: 'C∆Ø D√ÇN'">C∆Ø D√ÇN</span>
                </div>
                </div>
        </div>
    </header>

    <main class="main-content">
        <div style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; padding: 32px; border-radius: 12px; margin-bottom: 30px;">
            <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 8px;">
                üëã Xin ch√†o, <span th:text="${user?.hoVaTen} ?: 'C∆∞ D√¢n'">Nguy·ªÖn VƒÉn A</span>!
            </h1>
            <p style="font-size: 16px; opacity: 0.9;">
                Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi BlueMoon Portal - CƒÉn <span th:text="${canHoInfo?.maCanHo} ?: 'N/A'">A-1205</span>
            </p>
        </div>
        
        ...
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">H√≥a ƒê∆°n Th√°ng N√†y</span>
                    <div class="stat-icon blue">
                        <i class="fas fa-file-invoice"></i>
                    </div>
                </div>
                <div class="stat-value" th:text="${#numbers.formatCurrency(hoaDonStats?.soTienChuaThanhToan)} + ' ‚Ç´' ?: '0 ‚Ç´'">2.5M</div>
                <div th:with="statusClass=${hoaDonStats?.trangThai == 'ƒê√£ thanh to√°n' ? 'positive' : 'negative'}" th:class="|stat-change ${statusClass}|">
                    <i th:class="|fas ${hoaDonStats?.trangThai == 'ƒê√£ thanh to√°n' ? 'fa-check-circle' : 'fa-clock'}|"></i>
                    <span>[[${hoaDonStats?.trangThai} ?: 'Ch∆∞a c√≥ h√≥a ƒë∆°n']]</span>
                </div>
            </div>
...
            
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">D·ªãch V·ª• ƒê√£ ƒêƒÉng K√Ω</span>
                    <div class="stat-icon green">
                        <i class="fas fa-concierge-bell"></i>
                    </div>
                </div>
                <div class="stat-value" th:text="${dichVuStats?.tongDichVu ?: 0}">5</div>
                <div class="stat-change">
                    <i class="fas fa-info-circle"></i>
                    <span>[[${dichVuStats?.trangThai ?: 'N/A'}]]</span>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">S·ª± C·ªë ƒê√£ B√°o</span>
                    <div class="stat-icon orange">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                </div>
                <div class="stat-value" th:text="${suCoStats?.tongSuCo ?: 0}">2</div>
                <div th:with="statusClass=${suCoStats?.tyLeHoanThanh > 50 ? 'positive' : 'negative'}" th:class="|stat-change ${statusClass}|">
                    <i th:class="|fas ${suCoStats?.tyLeHoanThanh > 50 ? 'fa-check' : 'fa-hourglass-half'}|"></i>
                    <span>[[${suCoStats?.phanTramHoanThanh} ?: '0%']] ƒê√£ x·ª≠ l√Ω</span>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">Th√¥ng B√°o M·ªõi</span>
                    <div class="stat-icon purple">
                        <i class="fas fa-bell"></i>
                    </div>
                </div>
                <div class="stat-value" th:text="${thongBaoStats?.soLuongMoi ?: 0}">6</div>
                <div class="stat-change">
                    <i class="fas fa-envelope"></i>
                    <span>[[${thongBaoStats?.trangThai ?: 'N/A'}]]</span>
                </div>
            </div>
        </div>

        <div class="content-card" style="margin-bottom: 24px;">
            </div>

        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
            <div class="content-card">
                <div class="content-card-header">
                    <h2 class="content-card-title">üí∞ H√≥a ƒê∆°n G·∫ßn ƒê√¢y</h2>
                    <a th:href="@{/resident/fees}" class="btn btn-sm btn-outline">Xem t·∫•t c·∫£</a>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>M√£ Hƒê</th>
                                <th>Lo·∫°i Ph√≠</th>
                                <th>S·ªë Ti·ªÅn</th>
                                <th>H·∫°n</th>
                                <th>Tr·∫°ng Th√°i</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${#lists.isEmpty(recentHoaDon)}">
                                <td colspan="5" style="text-align: center; color: var(--gray);">Ch∆∞a c√≥ h√≥a ƒë∆°n n√†o ƒë∆∞·ª£c ph√°t h√†nh.</td>
                            </tr>
                            <tr th:each="hd : ${recentHoaDon}" 
                                th:with="isDue=${hd.trangThai?.name() == 'chua_thanh_toan'}">
                                <td>
                                    <a th:href="@{/resident/fee-detail(id=${hd.maHoaDon})}" style="color: var(--primary-color); font-weight: 600; text-decoration: none;">
                                        #HD[[${hd.maHoaDon}]]
                                    </a>
                                </td>
                                <td th:text="${hd.loaiHoaDon?.dbValue}">Ph√≠ Qu·∫£n L√Ω</td>
                                <td>
                                    <strong th:style="${isDue} ? 'color: var(--danger-color);' : ''" 
                                            th:text="|${#numbers.formatDecimal(hd.soTien, 0, 'POINT')} ‚Ç´|">2.500.000 ‚Ç´</strong>
                                </td>
                                <td th:text="${#temporals.format(hd.hanThanhToan, 'dd/MM/yyyy')}" th:style="${isDue} ? 'color: var(--danger-color);'">31/10/2024</td>
                                <td>
                                    <span th:class="|badge badge-${isDue ? 'warning' : 'success'}|" th:text="${hd.trangThai?.dbValue}">ƒê√£ thanh to√°n</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="content-card">
                <div class="content-card-header">
                    <h2 class="content-card-title">üè† Th√¥ng Tin H·ªô Gia ƒê√¨nh</h2>
                    <a href="#" class="btn btn-sm btn-outline" onclick="showFeatureToggle('Th√¥ng Tin H·ªô', 'T√≠nh nƒÉng ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn.')">Xem chi ti·∫øt</a>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px;">
                    <div>
                        <label style="font-size: 12px; color: var(--gray); display: block; margin-bottom: 4px;">CƒÉn H·ªô</label>
                        <p style="font-weight: 600; font-size: 18px; margin: 0;" th:text="${canHoInfo?.maCanHo} ?: 'N/A'">A-1205</p>
                    </div>
                    <div>
                        <label style="font-size: 12px; color: var(--gray); display: block; margin-bottom: 4px;">Ch·ªß H·ªô</label>
                         <p style="font-weight: 600; font-size: 18px; margin: 0;" th:text="${canHoInfo?.chuHo ?: user?.hoVaTen ?: 'N/A'}">Nguy·ªÖn VƒÉn Thanh</p>
                    </div>
                    <div>
                        <label style="font-size: 12px; color: var(--gray); display: block; margin-bottom: 4px;">T√¨nh Tr·∫°ng CƒÉn H·ªô</label>
                        <p style="margin: 0;">
                            <span th:class="${canHoInfo?.tinhTrang == 'Ho·∫°t ƒë·ªông'} ? 'badge badge-success' : 'badge badge-warning'" 
                                  th:text="${canHoInfo?.tinhTrang} ?: 'N/A'" style="font-size: 14px;">ƒêang ·ªü</span>
                        </p>
                    </div>
                    <div>
                        <label style="font-size: 12px; color: var(--gray); display: block; margin-bottom: 4px;">S·ªë Th√†nh Vi√™n</label>
                        <p style="font-weight: 600; font-size: 18px; margin: 0;" th:text="${hoGiaDinhStats?.tongThanhVien ?: 1}">4 ng∆∞·ªùi</p>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 BlueMoon Apartment Management System. All rights reserved.</p>
        </div>
    </footer>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/js/main.js"></script>
    
    <script>
        // H√†m hi·ªÉn th·ªã th√¥ng b√°o "T√≠nh nƒÉng ƒëang ph√°t tri·ªÉn" (Gi·ªØ nguy√™n)
        function featureToggle(element, message) {
            // ... (SweetAlert2 logic) ...
        }
        
        // C·∫ßn c√≥ h√†m toggleSidebar n·∫øu n√≥ ƒë∆∞·ª£c g·ªçi t·ª´ header
        function toggleSidebar() {
            $('aside.sidebar').toggleClass('active');
            $('main.main-content').toggleClass('sidebar-open');
            $('header.header').toggleClass('sidebar-open');
        }
    </script>
</body>

</html>